commands:
  01_disable_default_websocket:
    command: |
      echo "# Disabled default websocket configuration" > /tmp/no_websocket.conf
      if [ -f /etc/nginx/conf.d/websocket.conf ]; then
        mv /etc/nginx/conf.d/websocket.conf /etc/nginx/conf.d/websocket.conf.disabled
      fi
    ignoreErrors: true
  02_ensure_nginx_service:
    command: |
      if ! systemctl is-enabled nginx; then
        systemctl enable nginx || echo "Failed to enable nginx"
      fi
    ignoreErrors: true

files:
  "/opt/elasticbeanstalk/tasks/bundlelogs.d/01-app-logs.conf":
    mode: "000644"
    owner: root
    group: root
    content: |
      /var/log/nginx/access.log
      /var/log/nginx/error.log
      /var/log/web.stdout.log 