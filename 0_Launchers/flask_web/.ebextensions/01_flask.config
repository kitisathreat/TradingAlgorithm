option_settings:
  aws:elasticbeanstalk:application:environment:
    FLASK_ENV: production
    PYTHONPATH: "/var/app/current"
    PORT: 8000
  aws:elasticbeanstalk:container:python:
    WSGIPath: wsgi:application
  aws:elasticbeanstalk:environment:proxy:staticfiles:
    /static: static
  aws:autoscaling:launchconfiguration:
    InstanceType: t3.medium
    IamInstanceProfile: aws-elasticbeanstalk-ec2-role
  aws:elasticbeanstalk:environment:
    EnvironmentType: SingleInstance
  aws:elasticbeanstalk:application:environment:
    FLASK_DEBUG: false
    LOG_LEVEL: INFO
    SECRET_KEY: "your-secret-key-here-change-in-production"
    CORS_ORIGINS: "*"
    MODEL_SAVE_PATH: "/tmp/trading_model"
    DATA_CACHE_DIR: "/tmp/stock_data"

container_commands:
  01_install_dependencies:
    command: |
      pip install --upgrade pip
      pip install -r requirements.txt
    ignoreErrors: false
  02_test_imports:
    command: |
      python -c "
      import sys
      sys.path.append('/var/app/current')
      try:
          import flask_app
          print('Flask app imports successfully')
      except Exception as e:
          print(f'Import error: {e}')
          sys.exit(1)
      "
    ignoreErrors: false
  03_test_wsgi:
    command: |
      python -c "
      import sys
      sys.path.append('/var/app/current')
      try:
          from wsgi import application
          print('WSGI application loads successfully')
      except Exception as e:
          print(f'WSGI error: {e}')
          sys.exit(1)
      "
    ignoreErrors: false
  04_create_directories:
    command: "mkdir -p /tmp/trading_model /tmp/stock_data logs models cache"
  05_set_permissions:
    command: "chmod 755 /tmp/trading_model /tmp/stock_data"
  06_install_alpaca:
    command: "pip install alpaca-trade-api --no-deps"
  07_verify_orchestrator:
    command: "ls -la /var/app/current/_2_Orchestrator_And_ML_Python/ || echo 'Orchestrator not found'"
  08_set_pythonpath:
    command: "echo 'export PYTHONPATH=/var/app/current:/var/app/current/_2_Orchestrator_And_ML_Python:$PYTHONPATH' >> /etc/profile" 